var F=Object.defineProperty;var A=(r,t,e)=>t in r?F(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var s=(r,t,e)=>(A(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();class l{constructor(t,e){s(this,"_x",0);s(this,"_y",0);if(typeof t=="object"){const{x:i,y:n}=t;this._x=i,this._y=n;return}t&&(this._x=t),e&&(this._y=e)}get x(){return this._x}get y(){return this._y}getCoords(){return{x:this.x,y:this.y}}setCoords(t,e){this._x=t,this._y=e}setX(t){this._x=t}setY(t){this._y=t}addX(t){this._x+=t}addY(t){this._y+=t}subtractX(t){this._x-=t}subtractY(t){this._y-=t}}class b{constructor(t){s(this,"_minX");s(this,"_maxY");s(this,"_maxX");s(this,"_minY");this._minX=t.minX,this._maxX=t.maxX,this._minY=t.minY,this._maxY=t.maxY}get minX(){return this._minX}get maxX(){return this._maxX}get minY(){return this._minY}get maxY(){return this._maxY}setBounds(t){const{maxX:e,maxY:i,minX:n,minY:o}=t;this._maxX=e,this._maxY=i,this._minX=n,this._minY=o}}class Y{constructor(t){s(this,"position",new l);s(this,"viewBounds");s(this,"deadZone",null);s(this,"_trackedEntity",null);s(this,"scale",1);this.viewBounds=new b(t.viewBounds),t.deadZone&&(this.deadZone=new b(t.deadZone))}get trackedEntity(){return this._trackedEntity}get centerCameraCoordinates(){return this.getCameraCenterByCoords(this.position)}setViewBounds(t){this.viewBounds.setBounds(t)}setDeadZone(t){t&&(this.deadZone?this.deadZone.setBounds(t):this.deadZone=new b(t)),t===null&&(this.deadZone=null)}trackEntity(t){this._trackedEntity=t;const e=t.position.x-this.viewBounds.maxX/2+t.width/2,i=t.position.y-this.viewBounds.maxY/2+t.height/2;this.position.setCoords(e,i)}untrackEntity(){this._trackedEntity=null}update(t){this._trackedEntity&&this.centerOnTrackedEntity(t),this.deadZone&&this.position.x+this.viewBounds.maxX>this.deadZone.maxX&&this.position.setX(this.deadZone.maxX-this.viewBounds.maxX),this.deadZone&&this.position.x<this.deadZone.minX&&this.position.setX(this.deadZone.minX),this.deadZone&&this.position.y+this.viewBounds.maxY>this.deadZone.maxY&&this.position.setY(this.deadZone.maxY-this.viewBounds.maxY),this.deadZone&&this.position.y<this.deadZone.minY&&this.position.setY(this.deadZone.minY)}centerOnTrackedEntity(t){const e=this._trackedEntity.position.x+this._trackedEntity.width/2-t.canvas.width/2,i=this._trackedEntity.position.y+this._trackedEntity.height/2-t.canvas.height/2;this.position.setCoords(e,i)}setCoordinates(t){const{x:e,y:i}=t;this.position.setCoords(e,i)}getCameraCenterByCoords(t){const e=t.x+this.viewBounds.maxX/2,i=t.y+this.viewBounds.maxY/2;return{x:e,y:i}}moveTo(t){this.setCoordinates(t)}applyTransform(t){t.scale(this.scale,this.scale)}resetTransform(t){t.setTransform(1,0,0,1,0,0)}zoomIn(){this.scale*=1.1}zoomOut(){this.scale/=1.1}}class k{constructor(t){s(this,"image");s(this,"_frameWidth");s(this,"_frameHeight");s(this,"_uniqueName");s(this,"_elapsedTime",0);s(this,"_interval",16);s(this,"_frameIndex",0);s(this,"_row",0);s(this,"_col",0);s(this,"_numberOfRows");s(this,"_numberOfColumns");s(this,"_numberOfFrames");s(this,"_isFlipped",!1);if(!t.img)throw new Error("`img` argument is not provided in Sprite constructor!");if(t.img instanceof HTMLImageElement){if(!t.img.src)throw new Error("Sprite source is not provided!");this.image=t.img}this._frameHeight=t.frameHeight,this._frameWidth=t.frameWidth,this._uniqueName=t.uniqueName,t.interval&&(this._interval=t.interval),this._numberOfFrames=t.numberOfFrames,this._numberOfRows=t.numberOfRows,this._numberOfColumns=t.numberOfColumns}get frameWidth(){return this._frameWidth}get frameHeight(){return this._frameHeight}get uniqueName(){return this._uniqueName}get elapsedTime(){return this._elapsedTime}get interval(){return this._interval}get frameIndex(){return this._frameIndex}get row(){return this._row}get col(){return this._col}get numberOfRows(){return this._numberOfRows}get numberOfColumns(){return this._numberOfColumns}get numberOfFrames(){return this._numberOfFrames}get isFlipped(){return this._isFlipped}update(t){this._elapsedTime+=t.dt,this._elapsedTime>=this._interval&&(this._col++,this._frameIndex++,this._elapsedTime=0,this._col>this._numberOfColumns-1&&(this._row++,this._col=0),this._row>this._numberOfRows-1&&(this._row=0),this._frameIndex>=this._numberOfFrames&&(this._col=0,this._row=0,this._frameIndex=0))}flip(t){this._isFlipped=t}reset(){this._frameIndex=0,this._elapsedTime=0,this._col=0,this._row=0}render(t,e){t.save(),this._isFlipped&&t.scale(-1,1);const i=this._frameWidth*this._col,n=this._frameHeight*this._row,o=this._frameWidth,h=this._frameHeight,c=this._isFlipped?-e.coordinatesForRender.x-e.width:e.coordinatesForRender.x,u=e.coordinatesForRender.y,m=e.width,f=e.height;t.drawImage(this.image,i,n,o,h,c,u,m,f),t.restore()}}class R{constructor(t){s(this,"list",new Map);t&&(this.list=t)}addSprite(t,e){if(this.list.has(e))throw new Error("Sprite "+e+" already exist!");if(typeof t=="string"){const i=new Image;i.src=t,this.list.set(e,i)}else if(t instanceof Image){if(!t.src)throw new Error("Sprite source is not provided!");this.list.set(e,t)}}getSprite(t){const e=this.list.get(t);if(!e)throw new Error("Sprite with name "+t+" is not found!");return e}}class O{constructor(t,e){s(this,"list",new Map);s(this,"_currentAnimation",null);s(this,"entity");this.entity=t,e&&e.initialMap&&(this.list=e.initialMap,this.list.size>0&&(this._currentAnimation=[...this.list.values()][0]))}get currentAnimation(){return this._currentAnimation}resetCurrentAnimation(){var t;(t=this.currentAnimation)==null||t.reset()}setCurrentSprite(t){let e="";if(t instanceof k?e=t.uniqueName:typeof t=="string"&&(e=t),this._currentAnimation&&this._currentAnimation.uniqueName===e)return;this.resetCurrentAnimation();const i=this.list.get(e)??null;if(!i)throw new Error(`Sprite named ${t}`);this._currentAnimation=i}flipAll(t){for(const e of this.list.values())e.flip(t)}setSprite(t,e,i=!1){if(!i&&this.list.has(t))throw new Error(`Animation ${t} already exist!
If you want to replace animation use 3nd boolean argument.`);const n=this.entity.scene.spriteList.getSprite(t),o={...e,img:n},h=new k(o);this.list.set(t,h),this.setCurrentSprite(h)}}const p=class p{constructor(t){s(this,"_id");s(this,"position",new l);s(this,"_scene",null);s(this,"width",0);s(this,"height",0);s(this,"_update",null);s(this,"_render",null);s(this,"animations",new O(this));var e,i;p.ENTITIES_COUNT+=1,this._id=`entity_${p.ENTITIES_COUNT}`,t&&(t.initialPosition&&(this.position=new l((e=t.initialPosition)==null?void 0:e.x,(i=t.initialPosition)==null?void 0:i.y)),t.width&&(this.width=t.width),t.height&&(this.height=t.height),t.update&&(this._update=t.update),t.render&&(this._render=t.render),t.animations&&(this.animations=new O(this,t.animations)))}get scene(){return this._scene}get id(){return this._id}get coordinatesForRender(){const t=this.position.x-this._scene.camera.position.x,e=this.position.y-this._scene.camera.position.y;return{x:t,y:e}}setScene(t){this._scene=t}get sides(){const t=this.position.y,e=this.position.y+this.height,i=this.position.x,n=this.position.x+this.width;return{top:t,bottom:e,left:i,right:n}}checkCollision(t){if(t.id===this.id)return!1;const e=t.sides,i=this.sides;return e.left<i.right&&e.right>i.left&&e.top<i.bottom&&e.bottom>i.top}};s(p,"ENTITIES_COUNT",0);let g=p;class X{constructor(){s(this,"_entities");s(this,"scene",null);this._entities=new Map}get list(){return this._entities}addEntity(t){t.setScene(this.scene),this._entities.set(t.id,t)}getAllEntities(){return Array.from(this._entities.values())}getEntityById(t){const e=this._entities.get(t);return e||null}}const w=class w{constructor(t,e){s(this,"_entities");s(this,"_id");s(this,"ctx",null);s(this,"RAFid",null);s(this,"_timer");s(this,"_camera");s(this,"_physics");s(this,"spriteList");s(this,"_showFPS",!1);const i=new X;i.scene=this,this._entities=i,this._timer=new W,this._physics=new I,this.spriteList=new R(e==null?void 0:e.initialSprites),this._id=`scene_${w.CREATED_SCENES_COUNT}`,w.CREATED_SCENES_COUNT+=1,this._camera=new Y({viewBounds:{maxX:t.width,maxY:t.height,minX:0,minY:0}})}get physics(){return this._physics}get camera(){return this._camera}get timer(){return this._timer}get id(){return this._id}get entities(){return this._entities}drawBackground(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}renderFPS(t){if(this._showFPS){t.fillStyle="yellow",t.strokeStyle="black";const e=this._timer.fps+" FPS";t.font="bold 24px arial",t.textAlign="left",t.textBaseline="top",t.fillText(e,0,0),t.strokeText(e,0,0)}}render(t){t.save(),this.camera.applyTransform(t),this.drawBackground(t),this._entities.list.forEach(e=>e.render(t)),this.camera.resetTransform(t),this.renderFPS(t),t.restore()}update(){this._entities.list.forEach(t=>t.update(this._timer)),this.camera.update(this.ctx)}gameLoop(){this._timer.update(),this.update(),this.render(this.ctx),this.RAFid=window.requestAnimationFrame(this.gameLoop.bind(this))}play(){if(!this.ctx)throw new Error("Canvas rendering context is not defined for scene: "+this.id);this.gameLoop()}stop(){this.RAFid&&window.cancelAnimationFrame(this.RAFid)}showFPS(t){this._showFPS=t}};s(w,"CREATED_SCENES_COUNT",0);let C=w;class I{constructor(){s(this,"_worldGravity",9.8)}get worldGravity(){return this._worldGravity}setGravity(t){this._worldGravity=t}}class L{constructor(){s(this,"_scenes");s(this,"_currentScene",null);s(this,"ctx",null);this._scenes=[]}get currentScene(){return this._currentScene}get list(){return this._scenes}addScene(t){t.ctx=this.ctx,this._scenes.push(t)}changeCurrentScene(t){var e,i;if(typeof t=="string"){const n=this._scenes.find(o=>o.id===t);if(!n)throw new Error("Cannot find scene with id "+t);(e=this._currentScene)==null||e.stop(),this._currentScene=n}else t instanceof C&&((i=this._currentScene)==null||i.stop(),this._currentScene=t)}}class P{constructor(t){s(this,"scenes");if(!t)throw new Error("Cannot get Canvas Rendering Context from canvas.");this.scenes=new L,this.scenes.ctx=t}}class W{constructor(){s(this,"lastTime",Date.now());s(this,"_elapsedTime",0);s(this,"frames",[]);s(this,"_fps",0);s(this,"_dt",0)}get fps(){return this._fps}get elapsedTime(){return this._elapsedTime}get dt(){return this._dt}reset(){this._elapsedTime=0,this._dt=0}clearFrames(){for(let t=0;t<this.frames.length;t++)this.frames.pop()}updateFPS(){this.frames.push(1/(this._dt===0?1:this._dt));const t=this._elapsedTime+this._dt;if(Math.floor(t)>Math.floor(this._elapsedTime)){const e=this.frames.reduce((i,n)=>i+=n,this.frames[0])/this.frames.length;this._fps=Math.floor(e),this.clearFrames()}}update(){const t=Date.now();this._dt=(t-this.lastTime)/1e3,this._dt>2&&(this._dt=0),this.lastTime=t,this.updateFPS(),this._elapsedTime+=this.dt}}class B extends g{constructor(e){super(e);s(this,"fillColor","black");s(this,"strokeColor","black");s(this,"width",50);s(this,"height",50);s(this,"fill",!0);s(this,"stroke",!0);s(this,"strokeLineWidth",1);s(this,"updateCb",null);if(e){const{fillColor:i,strokeColor:n,height:o,width:h,fill:c,stroke:u,strokeLineWidth:m,updateCb:f}=e;i&&(this.fillColor=i),n&&(this.strokeColor=n),o&&(this.height=o),h&&(this.width=h),typeof c<"u"&&(this.fill=c),typeof u<"u"&&(this.stroke=u),m&&(this.strokeLineWidth=m),f&&(this.updateCb=f)}}render(e){const{x:i,y:n}=this.coordinatesForRender,{width:o,height:h}=this;this.animations.currentAnimation?this.animations.currentAnimation.render(e,this):(e.save(),e.fillStyle=this.fillColor,e.strokeStyle=this.strokeColor,e.lineWidth=this.strokeLineWidth,this.fill&&e.fillRect(i,n,o,h),this.stroke&&e.strokeRect(i,n,o,h),e.restore())}update(e){var i;if(!this.scene)throw new Error("Cannot find scene in entity "+this.id);(i=this.animations.currentAnimation)==null||i.update(e),this.updateCb&&this.updateCb(this,this.scene,e)}}class x{constructor(t,e){s(this,"a");s(this,"b");!t&&!e?(this.a=new l,this.b=new l):(this.a=new l(t),this.b=new l(e))}set(t,e){this.a=new l(t),this.b=new l(e)}zero(){this.a.setCoords(0,0),this.b.setCoords(0,0)}add(t){const{a:e,b:i}=t;this.a.setCoords(this.a.x+e.x,this.a.y+e.y),this.b.setCoords(this.b.x+i.x,this.b.y+i.y)}substract(t){const{a:e,b:i}=t;this.a.setCoords(this.a.x-e.x,this.a.y-e.y),this.b.setCoords(this.b.x-i.x,this.b.y-i.y)}get length(){const{a:t,b:e}=this,i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i**2+n**2)}get normalized(){const t=this.length;return t!==0?{x:(this.b.x-this.a.x)/t,y:(this.b.y-this.a.y)/t}:{x:0,y:0}}}class N extends g{constructor(e){super(e);s(this,"velocity",new x);s(this,"acceleration",new x);s(this,"_isGrounded",!1)}get isGrounded(){return this._isGrounded}update(e){if(this._isGrounded=this.checkIsGrounded(),this._isGrounded===!1)this.applyGravity(e);else{this.velocity.b.setY(0),this.acceleration.b.setY(0);const i=this.groundedOn();i&&this.position.setY(i.sides.top-this.height)}this.position.addY(this.velocity.b.y),this.position.addX(this.velocity.b.x),this._update&&this._update(e)}groundedOn(){let e=null;for(const i of this.scene.entities.getAllEntities()){if(i.id===this.id)continue;const n=this.predictFuturePosition();if(this.checkWasEntityThroughOtherEntity(i,n)){e=i;break}}return e}checkIsGrounded(){let e=!1;for(const i of this.scene.entities.getAllEntities()){if(i.id===this.id)continue;const n=this.predictFuturePosition();if(this.checkWasEntityThroughOtherEntity(i,n)){e=!0;break}}return e}predictFuturePosition(){const e=this.position.x+this.velocity.b.x,i=this.position.y+this.velocity.b.y;return{x:e,y:i}}checkWasEntityThroughOtherEntity(e,i){const n=e.sides,o={top:this.sides.top+i.y-this.position.y,left:this.sides.left+i.x-this.position.x,right:this.sides.right+i.x-this.position.x,bottom:this.sides.bottom+i.y-this.position.y};return o.bottom>=n.top&&o.top<=n.bottom&&o.left<=n.right&&o.right>=n.left}applyGravity(e){const i=new x;i.b.setY(this.scene.physics.worldGravity*e.dt),this.velocity.add(i)}}class Z extends N{constructor(e){super(e);s(this,"fillColor","black");s(this,"strokeColor","black");s(this,"fill",!0);s(this,"stroke",!0);s(this,"strokeLineWidth",1);s(this,"updateCb",null);if(e){const{fillColor:i,strokeColor:n,height:o,width:h,fill:c,stroke:u,strokeLineWidth:m,updateCb:f}=e;i&&(this.fillColor=i),n&&(this.strokeColor=n),o?this.height=o:this.height=50,h?this.width=h:this.width=50,typeof c<"u"&&(this.fill=c),typeof u<"u"&&(this.stroke=u),m&&(this.strokeLineWidth=m),f&&(this.updateCb=f)}}render(e){const{x:i,y:n}=this.coordinatesForRender,{width:o,height:h}=this;this.animations.currentAnimation?this.animations.currentAnimation.render(e,this):(e.save(),e.fillStyle=this.fillColor,e.strokeStyle=this.strokeColor,e.lineWidth=this.strokeLineWidth,this.fill&&e.fillRect(i,n,o,h),this.stroke&&e.strokeRect(i,n,o,h),e.restore())}update(e){var i;if(!this.scene)throw new Error("Cannot find scene in entity "+this.id);super.update(e),(i=this.animations.currentAnimation)==null||i.update(e),this.updateCb&&this.updateCb(this,this.scene,e)}}class G{constructor(t){s(this,"engine");s(this,"canvas");s(this,"ctx");if(!t)throw new Error("Missed argument 'canvas' in Game constructor!");this.canvas=t;const e=t.getContext("2d");if(!e)throw new Error("Cannot get Canvas Rendering Context from canvas.");this.ctx=e,this.engine=new P(this.ctx)}}const y=document.getElementById("canvas");y.height=window.innerHeight;y.width=window.innerWidth;y.style.cssText=`
display: block;
`;const S=new G(y),a=new C(y),d={};window.addEventListener("keydown",r=>{d[r.code]=!0});window.addEventListener("keyup",r=>{d[r.code]=!1});const D=(r,t)=>{const{dt:i}=t.timer,n=400*i;(d.KeyD===!0||d.ArrowRight===!0)&&(r.velocity.b.setX(n),r.animations.flipAll(!1)),(d.KeyA===!0||d.ArrowLeft===!0)&&(r.animations.flipAll(!0),r.velocity.b.setX(-n)),!d.KeyA&&!d.KeyD&&!d.ArrowLeft&&!d.ArrowRight?(r.velocity.b.setX(r.velocity.b.x/1.3),r.animations.setCurrentSprite("player_idle")):r.animations.setCurrentSprite("player_run"),d.Space===!0&&r.isGrounded&&r.velocity.b.setY(-4),r.isGrounded||r.animations.setCurrentSprite("player_jump"),r.position.y>900&&r.position.setCoords(0,0)},H="/canvas_game_engine",E=H+"/assets/char_sprites",v={idle:E+"/Player Sword Idle/sprite.png",run:E+"/Player Sword Run/sprite.png",jump:E+"/Sprite Sheets/jump.png"},_=new Z({initialPosition:{x:0,y:0},height:50,width:60,fill:!1,strokeColor:"black",strokeLineWidth:2,updateCb:D});a.spriteList.addSprite(v.run,"player_run");a.spriteList.addSprite(v.idle,"player_idle");a.spriteList.addSprite(v.jump,"player_jump");a.entities.addEntity(_);_.animations.setSprite("player_run",{frameHeight:40,frameWidth:48,numberOfColumns:8,numberOfRows:1,numberOfFrames:8,uniqueName:"player_run",interval:.08});_.animations.setSprite("player_jump",{frameHeight:40,frameWidth:48,numberOfColumns:3,numberOfRows:1,numberOfFrames:3,uniqueName:"player_jump",interval:.5});_.animations.setSprite("player_idle",{frameHeight:40,frameWidth:48,numberOfColumns:10,numberOfRows:1,numberOfFrames:10,uniqueName:"player_idle",interval:.08});_.animations.setCurrentSprite("player_run");a.showFPS(!0);a.camera.trackEntity(_);a.entities.addEntity(new B({initialPosition:{x:0,y:900},width:2e3,height:15,fillColor:"black"}));S.engine.scenes.addScene(a);S.engine.scenes.changeCurrentScene(a);var T;(T=S.engine.scenes.currentScene)==null||T.play();const M=document.getElementById("dead_zone_button");M.addEventListener("click",r=>{if(r.preventDefault(),a.camera.deadZone===null){const t={minX:-100,maxX:2100,maxY:900,minY:0};a.camera.setDeadZone(t)}else a.camera.setDeadZone(null)});
